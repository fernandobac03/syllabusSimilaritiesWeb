wkhomeControllers.controller("keywordsCloud",["$routeParams","$scope","globalData","sparqlQuery","searchData","$window",function(t,e,o,a,r,l){if($("html,body").animate({scrollTop:$("#scrollToTop").offset().top},"slow"),r.allkeywordsList)e.relatedthemes=r.allkeywordsList,e.selectedItem="";else{e.themes=[];var i=o.PREFIX+" CONSTRUCT { ?keyword rdfs:label ?key } \tFROM <"+o.centralGraph+'>  WHERE {      SELECT  (count(?key) as ?k) ?key          WHERE {              ?subject foaf:publications ?pub.              ?pub bibo:Quote ?key.              BIND(REPLACE(?key, " ", "_", "i") AS ?unickey).              BIND(IRI(?unickey) as ?keyword)          }      GROUP BY ?keyword  ?key      HAVING(?k > 1) }';a.querySrv({query:i},function(t){jsonld.compact(t,o.CONTEXT,function(t,o){_.map(o["@graph"],function(t){var o={};o.id=t["@id"],o.tag=t["rdfs:label"],e.themes.push({tag:o.tag})}),e.$apply(function(){r.allkeywordsList=e.themes,e.relatedthemes=r.allkeywordsList,e.selectedItem=""})})})}if(e.clickonAuthor=function(t){clickonRelatedauthor(t)},clickonRelatedauthor=function(i){var n=o.PREFIX+" CONSTRUCT {   <"+i+"> foaf:name ?name; a foaf:Person   }    WHERE  {Graph <"+o.centralGraph+">{     <"+i+"> a foaf:Person.     <"+i+"> foaf:name ?name } }";a.querySrv({query:n},function(a){jsonld.compact(a,o.CONTEXT,function(o,a){e.$apply(function(){r.authorSearch=a,l.location.hash="/"+t.lang+"/w/search?"+i})})})},e.todos=[],e.ctrlFn=function(t){var o=_.where(t,{"@type":"bibo:Document"}),a=_.where(t,{"@type":"foaf:Person"});e.todos=[],e.autores=[];var r={};_.map(o,function(t){r.id=t["@id"],r.title=t["dct:title"],r.author=t["dct:contributor"]?t["dct:contributor"]:[],r["abstract"]=t["bibo:abstract"]?t["bibo:abstract"]:"Sorry, still not found abstract for this publication.",r.uri=t["bibo:uri"]&&t["bibo:uri"]["@id"]?t["bibo:uri"]["@id"]:"",e.autores=[];var o=0;_.map(t["dct:contributors"],function(t){o+=1;var r=t["@id"]?_.findWhere(a,{"@id":t["@id"]}):_.findWhere(a,{"@id":t});e.autores.push({id:r["@id"],name:r["foaf:name"]})}),r.title&&e.todos.push({id:r.id,title:r.title,"abstract":r["abstract"],uri:r.uri,author:e.autores})}),$("html,body").animate({scrollTop:$("#scrollToHere").offset().top},"slow"),e.loadData()},e.loadData=function(){e.$apply(function(){e.filteredTodos=[],e.currentPage=1,e.numPerPage=10,e.maxSize=5,e.$watch("currentPage + numPerPage",function(){var t=(e.currentPage-1)*e.numPerPage,o=t+e.numPerPage;e.filteredTodos=e.todos.slice(t,o)})})},r.allkeywordsCloud)e.data=r.allkeywordsCloud;else{waitingDialog.show();var i=o.PREFIX+" CONSTRUCT {  ?keyword rdfs:label ?k;  uc:total ?totalPub }  FROM <"+o.centralGraph+">  WHERE {      SELECT ?keyword ?k (COUNT(DISTINCT(?subject)) AS ?totalPub)      WHERE {          ?person foaf:publications ?subject.          ?subject bibo:Quote ?k .          BIND(IRI(?k) AS ?keyword) .      }      GROUP BY ?keyword ?k      HAVING(?totalPub > 2 && ?totalPub < 180)      ORDER BY DESC(?totalPub)  LIMIT 145}";a.querySrv({query:i},function(t){jsonld.compact(t,o.CONTEXT,function(t,a){e.$apply(function(){e.data={schema:{context:o.CONTEXT,fields:["rdfs:label","uc:total"]},data:a},r.allkeywordsCloud={schema:{context:o.CONTEXT,fields:["rdfs:label","uc:total"]},data:a},waitingDialog.hide()})})})}e.$watch("selectedItem",function(t,l,i){if(t&&""!=t){waitingDialog.show();var n=o.PREFIX+" CONSTRUCT {  ?keyword rdfs:label ?key1;  uc:total ?totalPub  }  WHERE  {  SELECT DISTINCT ?key1 ?keyword (COUNT(DISTINCT(?publications)) AS ?totalPub) WHERE {     graph <"+o.centralGraph+'>         {         ?publications bibo:Quote ?key1.         ?publications bibo:Quote ?quote .          FILTER (mm:fulltext-search(?quote, "'+e.selectedItem+'")).         BIND(IRI(?key1) AS ?keyword)      }  }  GROUP BY ?key1 ?keyword    }';a.querySrv({query:n},function(t){jsonld.compact(t,o.CONTEXT,function(t,a){e.$apply(function(){e.data={schema:{context:o.CONTEXT,fields:["rdfs:label","uc:total"]},data:a},waitingDialog.hide()})})})}else e.data=r.allkeywordsCloud}),e.exportReport=function(t){e.keyw=t,e.showRepButtons=!0}}]);