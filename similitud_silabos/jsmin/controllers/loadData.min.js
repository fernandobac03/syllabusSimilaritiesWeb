wkhomeControllers.controller("loadData",["sparqlQuery","searchData","$translate","$routeParams","$scope","$window","translateService","globalData",function(t,e,r,o,a,u,l,s){function n(){var r=s.PREFIX+" CONSTRUCT { ?keyword rdfs:label ?key }  WHERE {      SELECT  (count(?pubs) as ?total)      WHERE {          graph <"+s.centralGraph+'> {             ?subject foaf:publications ?pubs.              ?pubs bibo:Quote ?key.              BIND(REPLACE(?key, " ", "_", "i") AS ?unickey).              BIND(IRI(?unickey) as ?keyword)          }     }      GROUP BY ?keyword  ?key      HAVING(?total > 4) }';t.querySrv({query:r},function(t){jsonld.compact(t,s.CONTEXT,function(t,r){_.map(r["@graph"],function(t){var e={};e.id=t["@id"],e.tag=t["rdfs:label"],a.themes.push({tag:e.tag})}),a.$apply(function(){e.allkeywords=a.themes}),waitingDialog.hide()})})}function c(){if(null==e.clustersAuthors||0==e.clustersAuthors.length){a.clusters=[];var r=[],o=(new Array,s.PREFIX+" CONSTRUCT {   ?author foaf:name ?name.   ?author uc:hasCluster ?clusterId.   ?author rdfs:label ?label.   ?author bibo:Quote ?keywords } WHERE {    graph <"+s.clustersGraph+">     {       ?clusterId uc:hasPerson ?author.      ?clusterId rdfs:label ?label.      {         select DISTINCT ?author ?name ?keywords         where         {          graph <"+s.centralGraph+">           {              ?author foaf:name ?name.              ?author foaf:publications ?publicationUri.              ?publicationUri bibo:Quote ?keywords.          }        } group by ?author ?name ?keywords       }    }}");t.querySrv({query:o},function(t){jsonld.compact(t,s.CONTEXT,function(t,o){_.map(o["@graph"],function(t){var e={},o=t["uc:hasCluster"],a="";if(null!=t["bibo:Quote"]&&(t["bibo:Quote"].constructor===Array||t["bibo:Quote"]instanceof Array))for(i=0;i<t["bibo:Quote"].length&&i<12;i++)a+=0==i?t["bibo:Quote"][i]:", "+t["bibo:Quote"][i];if(null!=o&&(o.constructor===Array||o instanceof Array))for(i=0;i<o.length;i++)e.IdAuthor=t["@id"],e.IdCluster=t["uc:hasCluster"][i]["@id"],e.ClusterName=t["rdfs:label"][i],e.Author=t["foaf:name"],e.Keyword=a,e.Title=t["foaf:name"],e.URI=t["foaf:name"],r.push({idAuthor:e.IdAuthor,cluster:e.IdCluster,clusterName:e.ClusterName,author:e.Author,keyword:e.Keyword,title:e.Title,uri:e.URI});else e.IdAuthor=t["@id"],e.IdCluster=t["uc:hasCluster"]["@id"],e.ClusterName=t["rdfs:label"],e.Author=t["foaf:name"],e.Keyword=a,e.Title=t["foaf:name"],e.URI=t["foaf:name"],r.push({idAuthor:e.IdAuthor,cluster:e.IdCluster,clusterName:e.ClusterName,author:e.Author,keyword:e.Keyword,title:e.Title,uri:e.URI})});var u=new Array;for(i=0,len=r.length;i<len;i++)null==u[r[i].cluster.toString()]&&(u[r[i].cluster.toString()]=new Array,u[r[i].cluster.toString()][0]=1,u[r[i].cluster.toString()][1]=0),u[r[i].cluster.toString()][0]=u[r[i].cluster.toString()][0]+1;for(i=0,len=r.length;i<len;i++)u[r[i].cluster.toString()][0]>4&&u[r[i].cluster.toString()][1]<95&&(a.clusters.push(r[i]),u[r[i].cluster.toString()][1]+=1);e.clustersAuthors=a.clusters,e.areaSearch=null})})}}n(),a.themes=[];var d=s.PREFIX+" CONSTRUCT {          ?keyword rdfs:label ?k;                uc:total ?totalPub }  FROM <"+s.centralGraph+">   WHERE {      SELECT ?keyword ?k (COUNT(DISTINCT(?subject)) AS ?totalPub)      WHERE {          ?person foaf:publications ?subject.          ?subject bibo:Quote ?k .          BIND(IRI(?k) AS ?keyword) .      }      GROUP BY ?keyword ?k      HAVING(?totalPub > 2 && ?totalPub < 180)      ORDER BY DESC(?totalPub)      LIMIT 145 } ";t.querySrv({query:d},function(t){jsonld.compact(t,s.CONTEXT,function(t,r){a.$apply(function(){e.allkeywordsCloud={schema:{context:s.CONTEXT,fields:["rdfs:label","uc:total"]},data:r},waitingDialog.hide()})})}),e.dataRequested||(c(),e.dataRequested=!0),a.clusters=[]}]);