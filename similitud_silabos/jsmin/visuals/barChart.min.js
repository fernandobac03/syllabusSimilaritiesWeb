"use strict";var barChart=angular.module("barChart",[]);barChart.factory("d3",function(){return d3}),barChart.directive("barChart",["d3","globalData","sparqlQuery",function(t,r,e){function n(r,e){function n(t){return{Autores:"#807dba",Publicaciones:"#e08214",Salud:"#41ab5d"}[t]}function a(n){function a(r){$("h2.selected").text(""),$("h2.selected").text(r[0]);var n=e.filter(function(t){return t.Source==r[0]})[0],a=t.keys(n.freq).map(function(t){return{type:t,freq:n.freq[t]}});f.update(a),p.update(a)}function u(t){$("h2.selected").text(""),$("h2.selected").text("Todas las Universidades"),f.update(d),p.update(d)}var i={},o={t:60,r:0,b:30,l:0};o.w=700-o.l-o.r,o.h=300-o.t-o.b;var l=r.append("svg").attr("width",o.w+o.l+o.r).attr("height",o.h+o.t+o.b).append("g").attr("transform","translate("+o.l+","+o.t+")"),s=t.scale.ordinal().rangeRoundBands([0,o.w],.1).domain(n.map(function(t){return t[0]}));l.append("g").attr("class","x axis").attr("transform","translate(0,"+o.h+")").call(t.svg.axis().scale(s).orient("bottom"));var h=t.scale.linear().range([o.h,0]).domain([0,t.max(n,function(t){return t[1]})]),m=l.selectAll(".bar").data(n).enter().append("g").attr("class","bar");return m.append("rect").attr("x",function(t){return s(t[0])}).attr("y",function(t){return h(t[1])}).attr("width",s.rangeBand()).attr("height",function(t){return o.h-h(t[1])}).attr("fill",c).on("mouseover",a).on("mouseout",u),m.append("text").text(function(r){return t.format(",")(r[1])}).attr("x",function(t){return s(t[0])+s.rangeBand()/2}).attr("y",function(t){return h(t[1])-5}).attr("text-anchor","middle"),i.update=function(r,e){h.domain([0,t.max(r,function(t){return t[1]})]);var n=l.selectAll(".bar").data(r);n.select("rect").transition().duration(500).attr("y",function(t){return h(t[1])}).attr("height",function(t){return o.h-h(t[1])}).attr("fill",e),n.select("text").transition().duration(500).text(function(r){return t.format(",")(r[1])}).attr("y",function(t){return h(t[1])-5})},i}function u(a){function u(t){s.update(e.map(function(t){}),n(t.data.type))}function i(t){s.update(e.map(function(t){return[t.Source,t.total]}),c)}function o(r){var e=t.interpolate(this._current,r);return this._current=e(0),function(t){return p(e(t))}}var d={},l={w:250,h:250};l.r=Math.min(l.w,l.h)/2;var f=r.append("svg").attr("width",l.w).attr("height",l.h).append("g").attr("transform","translate("+l.w/2+","+l.h/2+")"),p=t.svg.arc().outerRadius(l.r-10).innerRadius(0),h=t.layout.pie().sort(null).value(function(t){return t.freq});return f.selectAll("path").data(h(a)).enter().append("path").attr("d",p).attr("class","barchart").each(function(t){this._current=t}).style("fill",function(t){return n(t.data.type)}).on("mouseover",u).on("mouseout",i),d.update=function(t){f.selectAll("path").data(h(t)).transition().duration(500).attrTween("d",o)},d}function i(e){function a(r,e){return t.format("%")(r.freq/t.sum(e.map(function(t){return t.freq})))}var u={},i=r.append("table").attr("class","legend"),o=i.append("tbody").selectAll("tr").data(e).enter().append("tr");return o.append("td").append("svg").attr("width","16").attr("height","16").append("rect").attr("width","16").attr("height","16").attr("fill",function(t){return n(t.type)}),o.append("td").text(function(t){return t.type}),o.append("td").attr("class","legendFreq").text(function(r){return t.format(",")(r.freq)}),o.append("td").attr("class","legendPerc").text(function(t){return a(t,e)}),u.update=function(r){var e=i.select("tbody").selectAll("tr").data(r);e.select(".legendFreq").text(function(r){return t.format(",")(r.freq)}),e.select(".legendPerc").text(function(t){return a(t,r)})},u}var o=r;o.html("");var c="steelblue";e.forEach(function(t){t.total=0,t.total=parseInt(t.freq.Publicaciones)});var d=["Autores","Publicaciones"].map(function(r){return{type:r,freq:t.sum(e.map(function(t){return t.freq[r]}))}}),l=e.map(function(t){return[t.Source,t.total]}),s=a(l),f=u(d),p=i(d)}return{restrict:"E",scope:{data:"="},compile:function(r,e,a){var u=t.select(r[0]),i=parseInt(r.css("width"));e.pcWidth?e.pcWidth:i,e.pcHeight;return function(t,r,e){t.$watch("data",function(t,r,e){var a=e.data;a&&n(u,a)},!0)}}}}]);